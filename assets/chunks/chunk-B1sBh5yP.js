function I(e){return Array.from(new Set(e))}function T(e,t){const n=_();return n[e]=n[e]||t}function _(){const e="_vike";return globalThis[e]=globalThis[e]||{}}const B="0.4.224",W={projectVersion:B},l=new Proxy({},{get:(e,t)=>n=>t==="code"?`\`${n}\``:t==="string"?`'${n}'`:n}),a=T("utils/assertSingleInstance.ts",{instances:[],alreadyLogged:new Set}),N="Client runtime of both Server Routing and Client Routing loaded https://vike.dev/client-runtimes-conflict",x="Client runtime loaded twice https://vike.dev/client-runtime-duplicated";function C(){{const e=I(a.instances);A(e.length<=1,`vike@${l.bold(e[0])} and vike@${l.bold(e[1])} loaded but it's forbidden to load different versions`)}a.checkSingleInstance&&a.instances.length>1&&y(!1,x,{onlyOnce:!0,showStackTrace:!0})}function X(e){y(a.isClientRouting!==!1,N,{onlyOnce:!0,showStackTrace:!0}),y(a.isClientRouting===void 0,x,{onlyOnce:!0,showStackTrace:!0}),a.isClientRouting=!0,a.checkSingleInstance=!0,C()}function V(){a.instances.push(W.projectVersion),C()}function A(e,t){if(e)return;const n=`[vike][Wrong Usage] ${t}`;throw new Error(n)}function y(e,t,{onlyOnce:n,showStackTrace:o}){if(e)return;const r=`[vike][Warning] ${t}`;{const{alreadyLogged:i}=a,u=r;if(i.has(u))return;i.add(u)}console.warn(new Error(r))}function H(){return!(typeof process>"u"||!process.cwd||!process.versions||typeof process.versions.node>"u"||!process.release||process.release.name!=="node")}function g(e,t){const n=new Error(e);return H()&&(n.stack=U(n.stack,t)),n}function U(e,t){if(!e)return e;const n=J(e);let o=0;return n.filter(i=>i.includes(" (internal/")||i.includes(" (node:internal")?!1:o<t&&G(i)?(o++,!1):!0).join(`
`)}function G(e){return e.startsWith("    at ")}function J(e){return e.split(/\r?\n/)}function z(e){return typeof e=="object"&&e!==null}const s=T("utils/assert.ts",{alreadyLogged:new Set,logger(e,t){t==="info"?console.log(e):console.warn(e)},showStackTraceList:new WeakSet});V();const D="[vike]",F=`[vike@${W.projectVersion}]`,q="Bug",h=2;function Z(e,t){if(e)return;const n=(()=>{if(!t)return null;const u=typeof t=="string"?t:JSON.stringify(t);return l.dim(`Debug info (for Vike maintainers; you can ignore this): ${u}`)})();let r=[`You stumbled upon a Vike bug. Go to ${l.blue("https://github.com/vikejs/vike/issues/new?template=bug.yml")} and copy-paste this error. A maintainer will fix the bug (usually within 24 hours).`,n].filter(Boolean).join(" ");r=f(r),r=k(r,q),r=d(r,!0);const i=g(r,h);throw s.onBeforeLog?.(),i}function M(e,t,{showStackTrace:n}={}){if(e)return;n=n||s.alwaysShowStackTrace,t=f(t),t=k(t,"Wrong Usage"),t=d(t);const o=g(t,h);throw n&&s.showStackTraceList.add(o),s.onBeforeLog?.(),o}function K(e){return e=f(e),e=k(e,"Error"),e=d(e),g(e,h)}function Y(e,t,{onlyOnce:n,showStackTrace:o}){if(!e){if(o=o||s.alwaysShowStackTrace,t=f(t),t=k(t,"Warning"),t=d(t),n){const{alreadyLogged:r}=s,i=n===!0?t:n;if(r.has(i))return;r.add(i)}if(s.onBeforeLog?.(),o){const r=g(t,h);s.showStackTraceList.add(r),s.logger(r,"warn")}else s.logger(t,"warn")}}function ee(e,t,{onlyOnce:n}){t=f(t),t=d(t);{const{alreadyLogged:o}=s,r=t;if(o.has(r))return;o.add(r)}s.onBeforeLog?.(),s.logger(t,"info")}function k(e,t){let n=`[${t}]`;const o=t==="Warning"?"yellow":"red";return n=l.bold(l[o](n)),`${n}${e}`}function f(e){return e.startsWith("[")?e:` ${e}`}function d(e,t=!1){return`${t?F:D}${e}`}function m(e){const t=e/1e3;if(t<120){const n=L(t);return`${n} second${O(n)}`}{const n=t/60,o=L(n);return`${o} minute${O(o)}`}}function L(e){let t=e.toFixed(1);return t.endsWith(".0")&&(t=t.slice(0,-2)),t}function O(e){return e==="1"?"":"s"}const w=T("utils/executeHook.ts",{userHookErrors:new WeakMap,pageContext:null});function te(e,t,n){const{hookName:o,hookFilePath:r,hookTimeout:{error:i,warning:u}}=t;let $,p;const P=new Promise((c,R)=>{$=b=>{j(),c(b)},p=b=>{j(),R(b)}}),j=()=>{v&&clearTimeout(v),S&&clearTimeout(S)},v=E(u)&&setTimeout(()=>{Y(!1,`The ${o}() hook defined by ${r} is slow: it's taking more than ${m(u)} (https://vike.dev/hooksTimeout)`,{onlyOnce:!1})},u),S=E(i)&&setTimeout(()=>{const c=K(`The ${o}() hook defined by ${r} timed out: it didn't finish after ${m(i)} (https://vike.dev/hooksTimeout)`);p(c)},i);return(async()=>{try{Q(n);const c=await e();$(c)}catch(c){z(c)&&w.userHookErrors.set(c,{hookName:o,hookFilePath:r}),p(c)}})(),P}function E(e){return!!e&&e!==1/0}function Q(e){w.pageContext=e,Promise.resolve().then(()=>{w.pageContext=null})}export{M as a,l as b,Y as c,Z as d,te as e,K as f,T as g,ee as h,z as i,X as j,Q as p,I as u};
